import os
import pandas as pd
import matplotlib.pyplot as plt

def plot_results(data_dir):


    result_files = os.listdir(data_dir)

    exp_name = data_dir.removeprefix('results-')[:-7]  # six digits and a dash

    save_dir = f"plots-{exp_name}"

    for result in result_files:
        path = os.path.join(data_dir, result)
        df = pd.read_csv(path)

        model_name = result.removeprefix('results-').removesuffix('.csv')

        # separate train from test in df
        train_results = df[df.Training == True]
        test_results = df[df.Training == False]

        # Plot Loss
        fig, ax = plt.subplots()
        title = f"{exp_name}-{model_name} Loss"
        train_results['Loss'].plot(ax=ax, color = ['b'], legend=True,
                title=title, xlabel='Samples', ylabel='Loss').get_figure()

        fig = test_results['Loss'].plot(ax=ax, color = ['r']).get_figure()
        ax.legend(['Train', 'Test'])
        fig_path = os.path.join(save_dir, title)
        fig.savefig(fig_path)

        # Plot Accuracy
        fig, ax = plt.subplots()
        title = f"{exp_name}-{model_name} Binary Accuracy"
        train_results['Accuracy'].plot(ax=ax, color = ['b'], legend=True,
                title=title, xlabel='Samples', ylabel='Accuracy').get_figure()

        fig = test_results['Accuracy'].plot(ax=ax, color = ['r']).get_figure()
        ax.legend(['Train', 'Test'])
        fig_path = os.path.join(save_dir, title)
        fig.savefig(fig_path)

if __name__ == "__main__":

    path = "results-baseAdam-130223"
    plot_results(path)
